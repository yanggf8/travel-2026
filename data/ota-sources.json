{
  "$schema": "./schemas/ota-sources.schema.json",
  "version": "1.0.0",
  "sources": {
    "besttour": {
      "source_id": "besttour",
      "display_name": "喜鴻假期",
      "display_name_en": "Best Tour",
      "types": ["package"],
      "base_url": "https://www.besttour.com.tw",
      "markets": ["TW"],
      "currency": "TWD",
      "supported": true,
      "scraper_script": "scripts/scrape_package.py",
      "supports_listing": true,
      "listing_selectors": {
        "method": "anchor",
        "pattern": "/itinerary/([A-Z0-9]+)",
        "url_template": "/itinerary/{code}"
      },
      "product_lines": {
        "group": { "supported": true, "default": true }
      },
      "search_url_templates": {
        "listing": "/e_web/activity?v={region_slug}",
        "product": "/itinerary/{product_code}"
      },
      "region_slugs": {
        "tokyo": "japan_tokyo",
        "kansai": "japan_kansai",
        "hokkaido": "japan_hokkaido",
        "kyushu": "japan_kyushu",
        "okinawa": "japan_okinawa"
      },
      "rate_limit": {
        "requests_per_minute": 10
      },
      "notes": "Use listing URL for search, NOT /e_web/DOM/ (returns 404). Primarily group tours."
    },
    "liontravel": {
      "source_id": "liontravel",
      "display_name": "雄獅旅遊",
      "display_name_en": "Lion Travel",
      "types": ["package", "flight", "hotel"],
      "base_url": "https://www.liontravel.com",
      "markets": ["TW"],
      "currency": "TWD",
      "supported": true,
      "scraper_script": "scripts/scrape_liontravel_dated.py",
      "supports_listing": true,
      "listing_selectors": {
        "method": "fit_configurator",
        "notes": "FIT uses dynamic configurator, not traditional listing"
      },
      "product_lines": {
        "fit": {
          "supported": true,
          "default": true,
          "base_url": "https://vacation.liontravel.com",
          "url_template": "/search?Destination={dest_code}&FromDate={from_yyyymmdd}&ToDate={to_yyyymmdd}&Days={days}&roomlist={adults}-0-0"
        },
        "group": {
          "supported": false,
          "base_url": "https://travel.liontravel.com",
          "notes": "Group tour URL pattern unknown"
        }
      },
      "search_url_templates": {
        "fit": "https://vacation.liontravel.com/search?Destination={dest_code}&FromDate={from_yyyymmdd}&ToDate={to_yyyymmdd}&Days={days}&roomlist={adults}-0-0",
        "group": null
      },
      "destination_codes": {
        "tokyo_5d": "JP_TYO_5",
        "tokyo_6d": "JP_TYO_6",
        "osaka_5d": "JP_OSA_5",
        "osaka_6d": "JP_OSA_6",
        "hokkaido_5d": "JP_CTS_5",
        "okinawa_4d": "JP_OKA_4"
      },
      "rate_limit": {
        "requests_per_minute": 5
      },
      "limitations": [
        "fit_only_no_group_tour",
        "requires_specific_dest_code"
      ],
      "price_factors": [
        "holiday_departure_premium",
        "weekday_vs_weekend_pricing",
        "date_specific_pricing_varies_dramatically"
      ],
      "promo_codes": [
        {
          "code": "FITPKG",
          "discount": 400,
          "currency": "TWD",
          "min_purchase": 20000,
          "valid_days": ["Thursday"],
          "expires": null
        }
      ],
      "notes": "FIT search via vacation.liontravel.com, group tour URL unknown"
    },
    "tigerair": {
      "source_id": "tigerair",
      "display_name": "台灣虎航",
      "display_name_en": "Tigerair Taiwan",
      "types": ["flight"],
      "base_url": "https://www.tigerairtw.com",
      "markets": ["TW"],
      "currency": "TWD",
      "supported": true,
      "scraper_script": "scripts/scrape_tigerair.py",
      "supports_listing": false,
      "listing_selectors": null,
      "rate_limit": {
        "requests_per_minute": 10
      },
      "notes": "Form-based scraper (no URL deep-linking), requires Playwright form interaction. No listing page."
    },
    "lifetour": {
      "source_id": "lifetour",
      "display_name": "五福旅遊",
      "display_name_en": "Lifetour",
      "types": ["package", "flight", "hotel"],
      "base_url": "https://tour.lifetour.com.tw",
      "markets": ["TW"],
      "currency": "TWD",
      "supported": true,
      "scraper_script": "scripts/scrape_package.py",
      "supports_listing": true,
      "listing_selectors": {
        "method": "anchor",
        "pattern": "/detail\\?",
        "url_template": null
      },
      "product_lines": {
        "group": { "supported": true, "default": true },
        "semi_fit": {
          "supported": true,
          "keywords": ["伴自由", "半自由", "自由活動"],
          "notes": "Group tour with 1-2 free days built in. Search by keyword in listing."
        },
        "fit": {
          "supported": true,
          "base_url": "https://package.lifetour.com.tw",
          "notes": "FIT packages at package.lifetour.com.tw. Uses Peach/LCC - verify baggage."
        }
      },
      "search_url_templates": {
        "group_tour": "https://tour.lifetour.com.tw/searchlist/{departure}/{region_code}",
        "fit": "https://package.lifetour.com.tw/searchlist/all/{region_code}?datefrom={depart_date}&dateto={return_date}&order=1&standby=1",
        "product": "https://tour.lifetour.com.tw/detail*"
      },
      "fit_region_codes": {
        "kansai": "0019-0002",
        "tokyo": "0019-0001",
        "okinawa": "0019-0003",
        "hokkaido": "0019-0004"
      },
      "departures": {
        "taipei": "tpe",
        "taichung": "txg",
        "kaohsiung": "khh"
      },
      "region_codes": {
        "tokyo": "0001-0001",
        "kansai": "0001-0003",
        "hokkaido": "0001-0002",
        "kyushu": "0001-0004",
        "okinawa": "0001-0005"
      },
      "rate_limit": {
        "requests_per_minute": 5
      },
      "notes": "Group tour listing at tour.lifetour.com.tw/searchlist/{departure}/{region}. Some packages include 伴自由 (semi-FIT) days."
    },
    "settour": {
      "source_id": "settour",
      "display_name": "東南旅遊",
      "display_name_en": "Southeast Travel",
      "types": ["package", "flight", "hotel"],
      "base_url": "https://www.settour.com.tw",
      "markets": ["TW"],
      "currency": "TWD",
      "supported": true,
      "scraper_script": "scripts/scrape_package.py",
      "supports_listing": true,
      "listing_selectors": {
        "method": "container",
        "container": ".product-item",
        "title": ".product-title, h3, h4, .title",
        "price": ".ori-price-offer, .price",
        "code_regex": "slider-flightInfo_([A-Z0-9]+)",
        "url_template": "https://tour.settour.com.tw/product/{code}"
      },
      "product_lines": {
        "group": { "supported": true, "default": true },
        "fit": {
          "supported": true,
          "base_url": "https://fit.settour.com.tw",
          "notes": "FIT configurator - requires hotel regionId from search"
        }
      },
      "search_url_templates": {
        "group_tour": "https://tour.settour.com.tw/search?destinationCode={dest_code}",
        "fit": "https://fit.settour.com.tw/product/v2?adtCount={pax}&chdCount=0&directFlightOnly=true&depAirportCode={origin}&arrAirportCode={dest}&depDate={depart_yyyymmdd},{return_yyyymmdd}&roomQty=1&hotelCheckInDate={depart_yyyymmdd}&hotelCheckOutDate={return_yyyymmdd}&tripType=RT",
        "fit_search": "https://fit.settour.com.tw/search?adtCount={pax}&chdCount=0&depAirportCode={origin}&arrAirportCode={dest}&depDate={depart_yyyymmdd},{return_yyyymmdd}&tripType=RT",
        "product": "https://tour.settour.com.tw/product/*"
      },
      "destination_codes": {
        "tokyo": "JX_1",
        "kansai": "JX_3",
        "hokkaido": "JX_2",
        "kyushu": "JX_4",
        "okinawa": "JX_5"
      },
      "rate_limit": {
        "requests_per_minute": 5
      },
      "notes": "Group tour uses .product-item containers with code in slider-flightInfo_* IDs. FIT available at fit.settour.com.tw."
    },
    "travel4u": {
      "source_id": "travel4u",
      "display_name": "山富旅遊",
      "display_name_en": "Travel4U",
      "types": ["package"],
      "base_url": "https://www.travel4u.com.tw",
      "markets": ["TW"],
      "currency": "TWD",
      "supported": true,
      "scraper_script": "scripts/scrape_package.py",
      "supports_listing": true,
      "listing_selectors": {
        "method": "link",
        "pattern": "/group/product/([A-Z0-9]+)/",
        "url_template": "https://www.travel4u.com.tw/group/product/{code}/"
      },
      "product_lines": {
        "group": { "supported": true, "default": true },
        "fit": {
          "supported": false,
          "notes": "Travel4U primarily offers group tours"
        }
      },
      "search_url_templates": {
        "listing": "https://www.travel4u.com.tw/group/area/{area_code}/japan/",
        "product": "https://www.travel4u.com.tw/group/product/{product_code}/"
      },
      "area_codes": {
        "hokkaido": "39",
        "kansai": "40",
        "osaka": "40",
        "tokyo": "41",
        "kanto": "41",
        "kyushu": "42",
        "okinawa": "43",
        "nagoya": "49",
        "chubu": "49"
      },
      "rate_limit": {
        "requests_per_minute": 5
      },
      "notes": "山富旅遊 - Taiwan OTA with group tours. Area codes map to Japan regions."
    },
    "eztravel": {
      "source_id": "eztravel",
      "display_name": "易遊網",
      "display_name_en": "ezTravel",
      "types": ["package", "flight", "hotel"],
      "base_url": "https://www.eztravel.com.tw",
      "markets": ["TW"],
      "currency": "TWD",
      "supported": true,
      "scraper_script": "scripts/scrape_eztravel.py",
      "supports_listing": true,
      "listing_selectors": {
        "method": "card",
        "container": "[class*='hotel']",
        "price_regex": "TWD\\s*([\\d,]+)"
      },
      "product_lines": {
        "fit": {
          "supported": true,
          "default": true,
          "base_url": "https://packages.eztravel.com.tw"
        },
        "group": {
          "supported": true,
          "base_url": "https://vacation.eztravel.com.tw"
        }
      },
      "search_url_templates": {
        "fit": "https://packages.eztravel.com.tw/roundtrip-TPE-{dest_code}?checkin={depart_date}&checkout={return_date}&adult={pax}&child=0",
        "group": "https://vacation.eztravel.com.tw/pkgfrn/introduction/{product_code}"
      },
      "destination_codes": {
        "osaka": "OSA",
        "tokyo": "TYO",
        "kansai": "KIX",
        "nagoya": "NGO",
        "okinawa": "OKA",
        "sapporo": "CTS",
        "fukuoka": "FUK"
      },
      "rate_limit": {
        "requests_per_minute": 5
      },
      "limitations": [
        "baggage_not_included_in_fit",
        "dates_may_adjust_to_nearest_available"
      ],
      "notes": "FIT at packages.eztravel.com.tw. Hotels shown may be in different city than destination (e.g., Kobe for Osaka). Check baggage - typically NOT included with LCC flights."
    },
    "jalan": {
      "source_id": "jalan",
      "display_name": "じゃらん",
      "display_name_en": "Jalan",
      "types": ["hotel"],
      "base_url": "https://www.jalan.net",
      "markets": ["JP"],
      "currency": "JPY",
      "supported": false,
      "scraper_script": null,
      "notes": "Japan domestic OTA - for local hotel bookings"
    },
    "rakuten_travel": {
      "source_id": "rakuten_travel",
      "display_name": "楽天トラベル",
      "display_name_en": "Rakuten Travel",
      "types": ["hotel", "package"],
      "base_url": "https://travel.rakuten.co.jp",
      "markets": ["JP"],
      "currency": "JPY",
      "supported": false,
      "scraper_script": null,
      "notes": "Japan domestic OTA"
    },
    "trip": {
      "source_id": "trip",
      "display_name": "Trip.com",
      "display_name_en": "Trip.com",
      "types": ["flight"],
      "base_url": "https://www.trip.com",
      "markets": ["TW", "JP", "INTL"],
      "currency": "USD",
      "supported": true,
      "scraper_script": "scripts/scrape_package.py",
      "search_url_templates": {
        "flight_roundtrip": "https://www.trip.com/flights/{origin}-to-{dest}/tickets-{origin_code}-{dest_code}?dcity={origin_code}&acity={dest_code}&ddate={depart_date}&rdate={return_date}&flighttype=rt&class=y&quantity={pax}",
        "flight_oneway": "https://www.trip.com/flights/{origin}-to-{dest}/tickets-{origin_code}-{dest_code}?dcity={origin_code}&acity={dest_code}&ddate={depart_date}&flighttype=ow&class=y&quantity={pax}",
        "hotel": "https://www.trip.com/hotels/{city}-hotel-detail-{hotel_id}/?checkIn={checkin}&checkOut={checkout}&adult={adults}"
      },
      "rate_limit": {
        "requests_per_minute": 5
      },
      "limitations": [
        "no_flight_numbers_in_search",
        "hotel_requires_login",
        "roundtrip_shows_outbound_only"
      ],
      "price_factors": [
        "return_day_affects_price",
        "lcc_baggage_not_included"
      ],
      "notes": "Flight search works via Playwright. Hotel details require login. Roundtrip search only shows outbound - scrape return as separate one-way. Prices in USD, convert to TWD (~32)."
    },
    "booking": {
      "source_id": "booking",
      "display_name": "Booking.com",
      "display_name_en": "Booking.com",
      "types": ["hotel"],
      "base_url": "https://www.booking.com",
      "markets": ["TW", "JP", "INTL"],
      "currency": "TWD",
      "supported": false,
      "scraper_script": "scripts/scrape_package.py",
      "search_url_templates": {
        "search": "https://www.booking.com/searchresults.{lang}.html?dest_id={dest_id}&dest_type=city&checkin={checkin}&checkout={checkout}&group_adults={adults}&no_rooms={rooms}&selected_currency={currency}",
        "hotel": "https://www.booking.com/hotel/{country}/{hotel_slug}.{lang}.html?checkin={checkin}&checkout={checkout}"
      },
      "destination_ids": {
        "osaka": "-240905",
        "tokyo": "-246227",
        "kyoto": "-235402"
      },
      "rate_limit": {
        "requests_per_minute": 3
      },
      "limitations": [
        "cloudflare_protection",
        "search_may_need_retry",
        "requires_dest_id_parameter"
      ],
      "price_factors": [
        "price_per_night_not_total",
        "taxes_may_be_separate"
      ],
      "notes": "Cloudflare bot protection. Use lang=zh-tw for Traditional Chinese. Initial search may not load results - retry or use direct hotel URL. Prices shown per night."
    },
    "agoda": {
      "source_id": "agoda",
      "display_name": "Agoda",
      "display_name_en": "Agoda",
      "types": ["hotel"],
      "base_url": "https://www.agoda.com",
      "markets": ["TW", "JP", "INTL"],
      "currency": "TWD",
      "supported": true,
      "scraper_script": "scripts/scrape_package.py",
      "search_url_templates": {
        "hotel_page": "https://www.agoda.com/{hotel_slug}/hotel/{city_slug}-{country}.html?checkIn={checkin}&los={nights}&adults={adults}&rooms={rooms}&currency={currency}",
        "search": "https://www.agoda.com/search?city={city_id}&checkIn={checkin}&checkOut={checkout}&rooms={rooms}&adults={adults}&currency={currency}"
      },
      "city_ids": {
        "osaka": 14811,
        "tokyo": 5765,
        "kyoto": 5814,
        "nagoya": 17285,
        "sapporo": 10570,
        "fukuoka": 5788,
        "okinawa": 17074
      },
      "rate_limit": {
        "requests_per_minute": 3
      },
      "limitations": [
        "search_may_return_empty_for_far_future_dates",
        "direct_hotel_urls_most_reliable"
      ],
      "notes": "Direct hotel page URLs work reliably — full pricing, reviews, amenities. Search pages may return 0 results for dates >6 months out. Use hotel_page URL template for best results."
    },
    "skyscanner": {
      "source_id": "skyscanner",
      "display_name": "Skyscanner",
      "display_name_en": "Skyscanner",
      "types": ["flight"],
      "base_url": "https://www.skyscanner.com.tw",
      "markets": ["TW", "INTL"],
      "currency": "TWD",
      "supported": false,
      "scraper_script": null,
      "last_tested": "2026-02-06",
      "blocked_reason": "Hard captcha redirect (captcha-v2) triggered on all requests, even with stealth browser flags. Not bypassable with Playwright alone.",
      "notes": "Strong bot detection - returns 'Are you a robot?' captcha page. Redirects to /sttc/px/captcha-v2/. Stealth measures (disabling webdriver flag, custom UA) do not help. Use Google Flights instead for multi-airline price comparison."
    },
    "google_flights": {
      "source_id": "google_flights",
      "display_name": "Google Flights",
      "display_name_en": "Google Flights",
      "types": ["flight"],
      "base_url": "https://www.google.com/travel/flights",
      "markets": ["INTL"],
      "currency": "TWD",
      "supported": true,
      "scraper_script": "scripts/scrape_package.py",
      "search_url_templates": {
        "roundtrip": "https://www.google.com/travel/flights?q=Flights+to+{dest}+from+{origin}+on+{depart_date}+through+{return_date}&curr={currency}&hl=zh-TW",
        "oneway": "https://www.google.com/travel/flights?q=Flights+to+{dest}+from+{origin}+on+{depart_date}+one+way&curr={currency}&hl=zh-TW"
      },
      "rate_limit": {
        "requests_per_minute": 5
      },
      "notes": "Uses natural-language query URL format (?q=Flights to DEST from ORIGIN on DATE). Returns all-inclusive TWD prices with airline, times, duration, nonstop flags, and CO2 data. No form interaction needed."
    }
  }
}
