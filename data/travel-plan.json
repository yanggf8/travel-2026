{
  "schema_version": "4.2.0",
  "project": "Japan Travel 2026",
  "default_timezone": "Asia/Tokyo",
  "active_destination": "tokyo_2026",
  "budget": {
    "total_cap": null,
    "flight_cap": null,
    "accommodation_cap": null,
    "daily_cap": null,
    "pax": 2
  },
  "process_1_date_anchor": {
    "status": "confirmed",
    "updated_at": "2026-01-26T12:30:00+08:00",
    "set_out_date": "2026-02-11",
    "duration_days": 5,
    "return_date": "2026-02-15",
    "flexibility": {
      "date_flexible": true,
      "preferred_dates": [
        "2026-02-21",
        "2026-02-22"
      ],
      "avoid_dates": [
        "2026-02-14",
        "2026-02-15",
        "2026-02-16"
      ],
      "reason": "CNY peak pricing Feb 14-17"
    }
  },
  "destinations": {
    "tokyo_2026": {
      "slug": "tokyo_2026",
      "display_name": "Tokyo",
      "status": "active",
      "created_at": "2026-01-26T12:30:00+08:00",
      "updated_at": "2026-01-26T12:35:00+08:00",
      "process_1_date_anchor": {
        "status": "confirmed",
        "updated_at": "2026-01-27T09:50:37.324Z",
        "confirmed_dates": {
          "start": "2026-02-13",
          "end": "2026-02-17"
        },
        "days": 5
      },
      "process_2_destination": {
        "status": "confirmed",
        "updated_at": "2026-01-26T12:30:00+08:00",
        "origin_city": "Taipei",
        "origin_country": "Taiwan",
        "destination_country": "Japan",
        "region": "Kanto",
        "primary_airport": "NRT",
        "cities": [
          {
            "slug": "tokyo",
            "display_name": "Tokyo",
            "role": "primary",
            "nights": 4,
            "attractions": [
              "Shibuya",
              "Shinjuku",
              "Asakusa",
              "Akihabara",
              "Harajuku",
              "Tokyo Tower",
              "teamLab"
            ]
          },
          {
            "slug": "yokohama",
            "display_name": "Yokohama",
            "role": "day_trip",
            "nights": 0,
            "attractions": [
              "Chinatown",
              "Minato Mirai",
              "Cup Noodles Museum"
            ]
          }
        ],
        "shopping": [
          {
            "type": "second_hand_luxury",
            "stores": [
              "KOMEHYO Shinjuku",
              "BRAND OFF Shibuya",
              "Daikokuya"
            ]
          },
          {
            "type": "general",
            "stores": [
              "Shibuya 109",
              "Don Quijote",
              "Uniqlo Ginza"
            ]
          }
        ]
      },
      "process_3_4_packages": {
        "status": "booked",
        "updated_at": "2026-01-28T15:46:41.859Z",
        "selected_offer_id": "besttour_TYO06MM260213AM2",
        "results": {
          "offers": [
            {
              "id": "besttour_TYO06MM260213AM2",
              "source_id": "besttour",
              "product_code": "TYO06MM260213AM2",
              "url": "https://www.besttour.com.tw/itinerary/TYO06MM260213AM2",
              "scraped_at": "2026-01-26T12:26:39+08:00",
              "type": "package",
              "duration_days": 5,
              "currency": "TWD",
              "price_per_person": 18388,
              "price_total": 36776,
              "availability": "available",
              "seats_remaining": 2,
              "flight": {
                "airline": "Peach Aviation",
                "airline_code": "MM",
                "outbound": {
                  "flight_number": "MM620",
                  "departure_airport_code": "TPE",
                  "arrival_airport_code": "NRT",
                  "departure_time": "02:25",
                  "arrival_time": "06:30"
                },
                "return": {
                  "flight_number": "MM627",
                  "departure_airport_code": "NRT",
                  "arrival_airport_code": "TPE",
                  "departure_time": "22:05",
                  "arrival_time": "01:25+1"
                }
              },
              "hotel": {
                "name": "TAVINOS HAMAMATSUCHO",
                "slug": "tavinos_hamamatsucho",
                "area": "Shimbashi / Hamamatsucho",
                "star_rating": null,
                "access": [
                  "JR Hamamatsucho 8min",
                  "Yurikamome Takeshiba 1min",
                  "Tokyo Monorail 8min"
                ]
              },
              "includes": [
                "light_breakfast"
              ],
              "date_pricing": {
                "2026-02-03": {
                  "price": 19588,
                  "availability": "available",
                  "seats_remaining": 2
                },
                "2026-02-04": {
                  "price": 19988,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-05": {
                  "price": 19888,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-06": {
                  "price": 19888,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-11": {
                  "price": 21388,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-12": {
                  "price": 23388,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-13": {
                  "price": 27888,
                  "availability": "available",
                  "seats_remaining": 2,
                  "note": "Agent offered this date"
                },
                "2026-02-14": {
                  "price": 34888,
                  "availability": "available",
                  "seats_remaining": 2
                },
                "2026-02-15": {
                  "price": 33888,
                  "availability": "available",
                  "seats_remaining": 2
                },
                "2026-02-16": {
                  "price": 33888,
                  "availability": "available",
                  "seats_remaining": 2
                },
                "2026-02-17": {
                  "price": 35388,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-18": {
                  "price": 34388,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-19": {
                  "price": 27388,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-20": {
                  "price": 23388,
                  "availability": "available",
                  "seats_remaining": 2
                },
                "2026-02-21": {
                  "price": 19888,
                  "availability": "available",
                  "seats_remaining": 2
                },
                "2026-02-22": {
                  "price": 18388,
                  "availability": "available",
                  "seats_remaining": 2
                },
                "2026-02-23": {
                  "price": 18388,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-24": {
                  "price": 19388,
                  "availability": "available",
                  "seats_remaining": 2
                },
                "2026-02-25": {
                  "price": 22888,
                  "availability": "sold_out",
                  "seats_remaining": 0
                },
                "2026-02-26": {
                  "price": 22888,
                  "availability": "available",
                  "seats_remaining": 2
                }
              },
              "best_value": {
                "date": "2026-02-22",
                "price_per_person": 18388,
                "price_total": 36776
              },
              "pros": [
                "Package bundled",
                "Includes breakfast",
                "Good location",
                "Easy Haneda access"
              ],
              "cons": [
                "Feb 11-13 sold out",
                "CNY dates expensive",
                "Return flight unknown"
              ],
              "last_price_check": "2026-01-26T17:40:00+08:00"
            },
            {
              "id": "liontravel_tokyo_skytree_24hr_metro",
              "source_id": "liontravel",
              "product_code": "tokyo_skytree_24hr_metro",
              "url": "https://event.liontravel.com/zh-tw/japan/tokyo/index",
              "scraped_at": "2026-01-26T15:09:51+08:00",
              "type": "package",
              "duration_days": 5,
              "currency": "TWD",
              "price_per_person": 9930,
              "price_total": 19860,
              "availability": "available",
              "seats_remaining": null,
              "flight": {
                "airline": "Multiple options",
                "airline_code": null,
                "outbound": {
                  "flight_number": null,
                  "departure_airport_code": "TPE",
                  "arrival_airport_code": "NRT",
                  "departure_time": null,
                  "arrival_time": null
                },
                "return": null
              },
              "hotel": {
                "name": "自選住宿 (Asakusa/Ueno/Shinjuku options)",
                "slug": "self_select",
                "area": "Multiple",
                "star_rating": null,
                "access": []
              },
              "includes": [
                "wifi",
                "24hr_metro_pass"
              ],
              "date_pricing": null,
              "best_value": {
                "date": "flex",
                "price_per_person": 9930,
                "price_total": 19860
              },
              "pros": [
                "Cheapest starting price",
                "Includes 24hr metro",
                "Flexible hotel choice",
                "Good availability"
              ],
              "cons": [
                "Starting price only",
                "Flight details unknown",
                "Requires booking for exact price"
              ],
              "note": "適用期間：2025/08/01~2026/06/30"
            },
            {
              "id": "liontravel_tokyo_kawaguchiko",
              "source_id": "liontravel",
              "product_code": "tokyo_kawaguchiko",
              "url": "https://event.liontravel.com/zh-tw/japan/tokyo/index",
              "scraped_at": "2026-01-26T15:09:51+08:00",
              "type": "package",
              "duration_days": 5,
              "currency": "TWD",
              "price_per_person": 9780,
              "price_total": 19560,
              "availability": "available",
              "seats_remaining": null,
              "flight": {
                "airline": "Multiple options",
                "airline_code": null,
                "outbound": {
                  "departure_airport_code": "TPE",
                  "arrival_airport_code": "NRT"
                },
                "return": null
              },
              "hotel": {
                "name": "河口湖エリア (Kawaguchiko area)",
                "slug": "kawaguchiko_area",
                "area": "Kawaguchiko/Mt. Fuji",
                "star_rating": null,
                "access": []
              },
              "includes": [],
              "date_pricing": null,
              "best_value": {
                "date": "flex",
                "price_per_person": 9780,
                "price_total": 19560
              },
              "pros": [
                "Mt. Fuji view",
                "Lowest starting price",
                "Lake Kawaguchiko access"
              ],
              "cons": [
                "Starting price only",
                "Far from Tokyo center",
                "Limited nightlife"
              ],
              "note": "適用期間：2025/11/14~2026/06/30"
            },
            {
              "id": "liontravel_tokyo_disney",
              "source_id": "liontravel",
              "product_code": "tokyo_disney_esim",
              "url": "https://event.liontravel.com/zh-tw/japan/tokyo/index",
              "scraped_at": "2026-01-26T15:09:51+08:00",
              "type": "package",
              "duration_days": 5,
              "currency": "TWD",
              "price_per_person": 14888,
              "price_total": 29776,
              "availability": "available",
              "seats_remaining": null,
              "flight": {
                "airline": "Multiple options",
                "airline_code": null,
                "outbound": {
                  "departure_airport_code": "TPE",
                  "arrival_airport_code": "NRT"
                },
                "return": null
              },
              "hotel": {
                "name": "Disney Resort area hotel",
                "slug": "disney_area",
                "area": "Tokyo Disney Resort",
                "star_rating": null,
                "access": [
                  "JR Maihama Station"
                ]
              },
              "includes": [
                "wifi",
                "disney_ticket"
              ],
              "date_pricing": null,
              "best_value": {
                "date": "flex",
                "price_per_person": 14888,
                "price_total": 29776
              },
              "pros": [
                "Includes Disney ticket",
                "Includes eSIM",
                "Disney area hotel"
              ],
              "cons": [
                "Starting price only",
                "Far from central Tokyo",
                "Higher base price"
              ],
              "note": "適用期間：2025/11/13~2026/06/30"
            }
          ],
          "provenance": [
            {
              "source_id": "besttour",
              "scraped_at": "2026-01-26T17:40:00+08:00",
              "offers_found": 1,
              "note": "Full Feb 2026 calendar pricing scraped"
            },
            {
              "source_id": "liontravel",
              "scraped_at": "2026-01-26T17:38:00+08:00",
              "offers_found": 3,
              "note": "Base prices only - 5-day pricing requires booking flow"
            }
          ],
          "warnings": [
            "Return flight details not available for BestTour package",
            "Feb 11-12 SOLD OUT - Agent offered Feb 13 as alternative",
            "Lion Travel prices are 'starting from' for 2-3 nights - 5-day actual prices will be higher",
            "CNY peak (Feb 14-18): +80-90% premium over best dates"
          ]
        },
        "chosen_offer": {
          "id": "besttour_TYO06MM260213AM2",
          "selected_date": "2026-02-13",
          "selected_at": "2026-01-28T06:33:50.285Z"
        }
      },
      "process_3_transportation": {
        "status": "booked",
        "updated_at": "2026-01-29T05:55:27.894Z",
        "source": null,
        "flight": {
          "airline": "Scoot",
          "airline_code": "TR",
          "outbound": {
            "flight_number": "TR874",
            "departure_airport_code": "TPE",
            "arrival_airport_code": "NRT",
            "departure_time": "13:55",
            "arrival_time": "18:00",
            "date": "2026-02-13"
          },
          "return": {
            "flight_number": "TR875",
            "departure_airport_code": "NRT",
            "arrival_airport_code": "TPE",
            "departure_time": "19:55",
            "arrival_time": "23:10",
            "date": "2026-02-17"
          },
          "booked_date": "2026-02-13",
          "populated_at": "2026-01-28T06:33:50.285Z"
        },
        "home_to_airport": {
          "status": "planned",
          "candidates": [
            {
              "id": "nex_tokyo_nrt_1603",
              "method": "Narita Express (NEX)",
              "route": "Hamamatsucho → Tokyo Station → NRT",
              "departure_time": "16:03",
              "arrival_time": "17:00",
              "duration_min": 90,
              "cost_jpy": 3250,
              "transfers": 1,
              "amenities": [
                "toilet",
                "reserved_seat"
              ],
              "pros": [
                "Faster (arrive 30 min earlier)",
                "Train schedule reliable"
              ],
              "cons": [
                "1 transfer at Tokyo Station",
                "Luggage through station"
              ]
            },
            {
              "id": "access_express",
              "method": "Access Express",
              "route": "Daimon → Asakusa Line → NRT",
              "duration_min": 100,
              "cost_jpy": 1270,
              "transfers": 1,
              "amenities": [
                "toilet"
              ],
              "pros": [
                "Cheapest option"
              ],
              "cons": [
                "More crowded",
                "Less luggage space"
              ]
            }
          ]
        },
        "airport_to_hotel": {
          "status": "planned",
          "candidates": [
            {
              "id": "nex_nrt_tokyo_1903",
              "method": "Narita Express (NEX)",
              "route": "NRT → Tokyo Station → Hamamatsucho",
              "departure_time": "19:03",
              "arrival_time": "20:15",
              "duration_min": 72,
              "cost_jpy": 3250,
              "transfers": 1,
              "amenities": [
                "toilet",
                "reserved_seat"
              ],
              "pros": [
                "Faster (arrive 1h 10m earlier)",
                "No traffic delays"
              ],
              "cons": [
                "1 transfer at Tokyo Station",
                "Less time for dinner at airport"
              ]
            },
            {
              "id": "access_express",
              "method": "Access Express",
              "route": "NRT → Aoto → Asakusa Line → Daimon",
              "duration_min": 100,
              "cost_jpy": 1270,
              "transfers": 1,
              "amenities": [
                "toilet"
              ],
              "pros": [
                "Cheapest option"
              ],
              "cons": [
                "More crowded",
                "Less luggage space",
                "Multiple transfers"
              ]
            },
            {
              "id": "skyliner_ueno",
              "method": "Keisei Skyliner",
              "route": "NRT → Ueno → JR Hamamatsucho",
              "duration_min": 75,
              "cost_jpy": 2700,
              "transfers": 1,
              "amenities": [
                "toilet",
                "reserved_seat"
              ],
              "pros": [
                "Fast to Ueno"
              ],
              "cons": [
                "Transfer at Ueno",
                "Longer walk/transfer"
              ]
            }
          ]
        },
        "airport_transfers": {
          "arrival": {
            "status": "planned",
            "selected": {
              "id": "arrival_limousine_bus_nl22oq",
              "title": "Limousine Bus",
              "route": "NRT T2 → Shiodome (Takeshiba)",
              "duration_min": 85,
              "price_yen": 3200,
              "schedule": "19:40 → ~21:05"
            },
            "candidates": [
              {
                "id": "arrival_nex_yamanote_hfe9zm",
                "title": "NEX + Yamanote",
                "route": "NRT → Tokyo → Hamamatsucho",
                "duration_min": 75,
                "price_yen": 3250
              },
              {
                "id": "arrival_access_express_uiy0mg",
                "title": "Access Express",
                "route": "NRT → Aoto → Shimbashi",
                "duration_min": 90,
                "price_yen": 1270
              }
            ]
          },
          "departure": {
            "status": "planned",
            "selected": {
              "id": "departure_limousine_bus_muxda5",
              "title": "Limousine Bus",
              "route": "Takeshiba → NRT T2",
              "duration_min": 120,
              "price_yen": 3200,
              "schedule": "15:30 → ~17:30"
            },
            "candidates": [
              {
                "id": "departure_nex_yamanote_wt5uvm",
                "title": "NEX + Yamanote",
                "route": "Hamamatsucho → Tokyo → NRT",
                "duration_min": 90,
                "price_yen": 3250
              },
              {
                "id": "departure_access_express_pjjjzu",
                "title": "Access Express",
                "route": "Daimon → Asakusa Line → NRT",
                "duration_min": 100,
                "price_yen": 1270
              }
            ]
          }
        },
        "populated_from": "package:besttour_TYO05MM260211AM"
      },
      "process_4_accommodation": {
        "status": "booked",
        "updated_at": "2026-01-28T15:46:41.859Z",
        "source": null,
        "location_zone": {
          "status": "pending",
          "selected_area": null,
          "candidates": [
            {
              "slug": "shimbashi",
              "display_name": "Shimbashi / Hamamatsucho",
              "pros": [
                "Easy Haneda access"
              ],
              "cons": [
                "Business area"
              ]
            },
            {
              "slug": "shinjuku",
              "display_name": "Shinjuku",
              "pros": [
                "Entertainment",
                "Shopping"
              ],
              "cons": [
                "Far from Haneda"
              ]
            },
            {
              "slug": "asakusa",
              "display_name": "Asakusa",
              "pros": [
                "Traditional"
              ],
              "cons": [
                "Far from Shibuya"
              ]
            }
          ]
        },
        "hotel": {
          "name": "TAVINOS HAMAMATSUCHO",
          "slug": "tavinos_hamamatsucho",
          "area": "Shimbashi / Hamamatsucho",
          "star_rating": null,
          "access": [
            "JR Hamamatsucho 8min",
            "Yurikamome Takeshiba 1min",
            "Tokyo Monorail 8min"
          ],
          "check_in": "2026-02-13",
          "populated_at": "2026-01-28T06:33:50.285Z"
        },
        "populated_from": "package:besttour_TYO05MM260211AM"
      },
      "process_5_daily_itinerary": {
        "status": "researched",
        "updated_at": "2026-02-02T05:20:47.267Z",
        "days": [
          {
            "date": "2026-02-13",
            "day_number": 1,
            "day_type": "arrival",
            "status": "planned",
            "theme": "Arrival + Rest + Hamamatsucho Explore",
            "morning": {
              "focus": "Departure from TPE",
              "activities": [
                "TPE Airport",
                "TR874 TPE 13:55 → NRT 18:00"
              ],
              "meals": [
                "Lunch before flight or airport"
              ],
              "transit_notes": "NRT arrival 18:00",
              "booking_notes": "Arrive Narita by 13:00 for check-in"
            },
            "afternoon": {
              "focus": "Flight & Arrival & Dinner at Narita",
              "activities": [
                "Flight time: 4h05m",
                "18:00 Land NRT T2",
                "18:45 Immigration & baggage",
                "18:50-19:30 Dinner at Narita T2",
                "19:40 Limousine Bus (SuperCabin) to Takeshiba"
              ],
              "meals": [
                "Dinner at Narita T2 (ramen, sushi, udon options)"
              ],
              "transit_notes": "Limousine Bus 19:40 → Takeshiba 21:25",
              "booking_notes": "Pre-book Limousine Bus online"
            },
            "evening": {
              "focus": "Hotel Check-in & Rest",
              "activities": [
                "21:25 Arrive Takeshiba stop",
                "21:30 Walk to TAVINOS Hamamatsucho (3 min)",
                "Hotel check-in",
                "Rest after travel day"
              ],
              "meals": [
                "Already ate at Narita"
              ],
              "transit_notes": "Takeshiba stop → Hotel (3 min walk)",
              "booking_notes": "Late check-in OK, hotel has 24h front desk"
            }
          },
          {
            "date": "2026-02-14",
            "day_number": 2,
            "day_type": "full",
            "status": "planned",
            "theme": "Shinjuku: Chanel Shopping + Omiyage",
            "morning": {
              "focus": "KOMEHYO Shinjuku (Chanel Bags)",
              "activities": [
                "Hamamatsucho → Shinjuku (JR Yamanote, 25 min)",
                "KOMEHYO Shinjuku main store (opens 11:00)",
                "Browse 5 floors, focus on Chanel section"
              ],
              "meals": [
                "Breakfast at hotel"
              ],
              "transit_notes": "JR Hamamatsucho Station → Shinjuku (Yamanote Line, ¥200, 25 min). Use Suica/Pasmo IC card.",
              "booking_notes": "KOMEHYO opens 11:00, arrive early for best selection"
            },
            "afternoon": {
              "focus": "Backup Store + Omiyage",
              "activities": [
                "Daikokuya Shinjuku (backup, 5 min walk) if needed",
                "Isetan Shinjuku B2 for omiyage (Yoku Moku, Henri Charpentier)",
                "Browse Shinjuku area"
              ],
              "meals": [
                "Lunch at Isetan restaurant floor or nearby"
              ],
              "transit_notes": "All walking distance in Shinjuku",
              "booking_notes": null
            },
            "evening": {
              "focus": "Shinjuku Nightlife",
              "activities": [
                "Omoide Yokocho (Memory Lane) for dinner",
                "Kabukicho walk-through",
                "Return to hotel"
              ],
              "meals": [
                "Yakitori at Omoide Yokocho"
              ],
              "transit_notes": "JR Shinjuku → Hamamatsucho (Yamanote Line, ¥200, 25 min)",
              "booking_notes": null
            }
          },
          {
            "date": "2026-02-15",
            "day_number": 3,
            "day_type": "full",
            "status": "planned",
            "theme": "teamLab Borderless + Azabudai/Roppongi",
            "morning": {
              "focus": "teamLab Borderless",
              "activities": [
                "Hamamatsucho → Kamiyacho (Metro, 10 min)",
                {
                  "id": "activity_mkyzc52c_9diw",
                  "title": "teamLab Borderless at Azabudai Hills (opens 10:00)",
                  "area": "",
                  "nearest_station": null,
                  "duration_min": null,
                  "booking_required": true,
                  "booking_url": null,
                  "booking_status": "pending",
                  "book_by": "2026-02-10",
                  "cost_estimate": null,
                  "tags": [],
                  "notes": null,
                  "priority": "want"
                },
                "Allow 2-3 hours for full experience"
              ],
              "meals": [
                "Light breakfast at hotel"
              ],
              "transit_notes": "Daimon Station → Kamiyacho (Metro Hibiya Line, ¥180, 10 min). teamLab is 5 min walk from Kamiyacho exit.",
              "booking_notes": "BOOK TICKETS IN ADVANCE - often sells out"
            },
            "afternoon": {
              "focus": "Azabudai Hills + Roppongi",
              "activities": [
                "Explore Azabudai Hills (new complex)",
                "Walk to Roppongi Hills",
                "Mori Art Museum or Tokyo City View (optional)"
              ],
              "meals": [
                "Lunch at Azabudai Hills restaurants"
              ],
              "transit_notes": "Walking distance Azabudai → Roppongi",
              "booking_notes": null
            },
            "evening": {
              "focus": "Roppongi Dinner",
              "activities": [
                "Dinner in Roppongi",
                "Return to hotel"
              ],
              "meals": [
                "Upscale dining or casual izakaya"
              ],
              "transit_notes": "Roppongi → Daimon (Toei Oedo Line, ¥220, 15 min). Walk to hotel 5 min.",
              "booking_notes": null
            }
          },
          {
            "date": "2026-02-16",
            "day_number": 4,
            "day_type": "full",
            "status": "planned",
            "theme": "Classic Tokyo: Asakusa + Shibuya",
            "morning": {
              "focus": "Asakusa Traditional",
              "activities": [
                "Hamamatsucho → Asakusa (Metro/Asakusa Line, 20 min)",
                "Senso-ji Temple",
                "Nakamise Shopping Street",
                "Kaminarimon Gate photos"
              ],
              "meals": [
                "Breakfast at hotel or skip for early start"
              ],
              "transit_notes": "Daimon → Asakusa (Toei Asakusa Line, ¥280, 20 min direct). Exit A4 for Kaminarimon.",
              "booking_notes": null
            },
            "afternoon": {
              "focus": "Shibuya",
              "activities": [
                "Asakusa → Shibuya (Metro, 30 min)",
                "Shibuya Crossing",
                "Shibuya Sky observation deck (optional)",
                "Shibuya 109 / shopping"
              ],
              "meals": [
                "Lunch in Asakusa (soba, tempura) or Shibuya"
              ],
              "transit_notes": "Asakusa → Shibuya (Metro Ginza Line, ¥250, 30 min direct). Exit Hachiko side for crossing.",
              "booking_notes": "Shibuya Sky needs advance booking if interested"
            },
            "evening": {
              "focus": "Shibuya/Harajuku Evening",
              "activities": [
                "Walk to Harajuku (10 min)",
                "Takeshita Street",
                "Omotesando for upscale window shopping",
                "Dinner and return"
              ],
              "meals": [
                "Dinner in Harajuku/Omotesando area"
              ],
              "transit_notes": "Harajuku → Hamamatsucho (JR Yamanote Line, ¥200, 20 min). Or walk Harajuku → Shibuya (10 min) then Yamanote.",
              "booking_notes": null
            }
          },
          {
            "date": "2026-02-17",
            "day_number": 5,
            "day_type": "departure",
            "status": "planned",
            "theme": "Last-Minute Omiyage + Departure",
            "morning": {
              "focus": "Flexible / Pack",
              "activities": [
                "Sleep in",
                "Pack luggage",
                "Hotel checkout (11:00)",
                "Store luggage at hotel or Tokyo Station coin lockers"
              ],
              "meals": [
                "Breakfast at hotel"
              ],
              "transit_notes": null,
              "booking_notes": "Confirm luggage storage options"
            },
            "afternoon": {
              "focus": "Relax Near Hotel + Lunch",
              "activities": [
                "Stay around Hamamatsucho/Shiodome area",
                "Hamarikyu Gardens (optional, ¥300, 10 min walk)",
                "Lunch at Shiodome City Center or Caretta Shiodome",
                "Return to hotel to pick up luggage by 14:45"
              ],
              "meals": [
                "Lunch in Hamamatsucho/Shiodome area"
              ],
              "transit_notes": "All walking distance from hotel. No train needed.",
              "booking_notes": "Omiyage already done Day 2 at Isetan Shinjuku B2"
            },
            "evening": {
              "focus": "Airport Transfer via Limousine Bus",
              "activities": [
                "15:00 Leave hotel with luggage",
                "15:05 Walk to Takeshiba bus stop (3 min)",
                "15:30 Limousine Bus (SuperCabin) departs",
                "17:30 Arrive NRT T2",
                "Check-in and security",
                "Duty-free shopping + light dinner at airport",
                "19:55 TR875 departs NRT → TPE 23:10"
              ],
              "meals": [
                "Light dinner at NRT T2 after check-in"
              ],
              "transit_notes": "Limousine Bus: Takeshiba 15:30 → NRT 17:30 (¥3,200)",
              "booking_notes": "Pre-book Limousine Bus online"
            }
          }
        ],
        "scaffolded_at": "2026-01-28T09:00:48.959Z",
        "populated_at": "2026-01-28T10:00:00.000Z",
        "notes": "Main goals: Chanel bags (KOMEHYO), Omiyage (Isetan + Daimaru), teamLab Borderless. Balanced pace with red-eye recovery Day 1.",
        "transit_summary": {
          "hotel_station": "JR Hamamatsucho (8 min walk) or Daimon (5 min walk)",
          "ic_card": "Get Suica or Pasmo at Narita airport - works on all trains/metro",
          "daily_transit_cost": "¥600-800 typical per day",
          "key_lines": [
            "JR Yamanote (green loop) - Shinjuku, Shibuya, Harajuku, Tokyo Station",
            "Toei Asakusa Line - Asakusa direct from Daimon",
            "Metro Hibiya Line - Kamiyacho (teamLab)",
            "Toei Oedo Line - Roppongi from Daimon"
          ],
          "tips": [
            "Daimon Station is closer than Hamamatsucho for metro lines",
            "JR Yamanote handles most trips - no transfers needed",
            "Google Maps works well for real-time transit in Tokyo"
          ]
        }
      }
    },
    "nagoya_2026": {
      "slug": "nagoya_2026",
      "display_name": "Nagoya",
      "status": "archived",
      "created_at": "2026-01-23T16:00:00+08:00",
      "updated_at": "2026-01-26T12:35:00+08:00",
      "archived_at": "2026-01-26T12:30:00+08:00",
      "process_2_destination": {
        "status": "confirmed",
        "updated_at": "2026-01-23T16:30:00+08:00",
        "origin_city": "Taipei",
        "origin_country": "Taiwan",
        "destination_country": "Japan",
        "region": "Chubu",
        "primary_airport": "NGO",
        "cities": [
          {
            "slug": "nagoya",
            "display_name": "Nagoya",
            "role": "primary",
            "nights": 4,
            "attractions": [
              "Nagoya Castle",
              "Atsuta Shrine",
              "Osu Shopping District"
            ]
          },
          {
            "slug": "takayama",
            "display_name": "Takayama",
            "role": "day_trip",
            "nights": 0,
            "attractions": [
              "Old Town",
              "Morning Markets"
            ]
          },
          {
            "slug": "inuyama",
            "display_name": "Inuyama",
            "role": "day_trip",
            "nights": 0,
            "attractions": [
              "Inuyama Castle"
            ]
          }
        ]
      },
      "process_3_4_packages": {
        "status": "pending",
        "updated_at": "2026-01-26T12:35:00+08:00",
        "selected_offer_id": null,
        "results": {
          "offers": [],
          "provenance": [],
          "warnings": []
        }
      },
      "process_3_transportation": {
        "status": "researched",
        "updated_at": "2026-01-23T16:30:00+08:00",
        "source": "direct_research",
        "flight": {
          "status": "researched",
          "candidates": [
            {
              "id": "direct_flight_ngo_tigerair_001",
              "source_id": "direct_research",
              "product_code": "IT206_IT207",
              "type": "flight",
              "currency": "TWD",
              "price_per_person": 6700,
              "price_total": 13400,
              "availability": "estimated",
              "flight": {
                "airline": "Tigerair Taiwan",
                "airline_code": "IT",
                "outbound": {
                  "flight_number": "IT206",
                  "departure_airport_code": "TPE",
                  "arrival_airport_code": "NGO",
                  "departure_time": "2026-02-11T09:00:00+08:00",
                  "arrival_time": "2026-02-11T12:55:00+09:00"
                },
                "return": {
                  "flight_number": "IT207",
                  "departure_airport_code": "NGO",
                  "arrival_airport_code": "TPE",
                  "departure_time": "2026-02-15T13:45:00+09:00",
                  "arrival_time": "2026-02-15T15:55:00+08:00"
                }
              },
              "pros": [
                "Daily flights",
                "Good times",
                "Direct to Nagoya"
              ],
              "cons": [
                "CNY may have premium"
              ]
            }
          ]
        }
      },
      "process_4_accommodation": {
        "status": "pending",
        "updated_at": "2026-01-23T16:30:00+08:00",
        "source": null,
        "location_zone": {
          "candidates": [
            {
              "slug": "nagoya_station",
              "display_name": "Nagoya Station Area"
            },
            {
              "slug": "sakae",
              "display_name": "Sakae"
            }
          ]
        },
        "hotel": {
          "status": "pending",
          "candidates": []
        }
      },
      "process_5_daily_itinerary": {
        "status": "pending",
        "updated_at": "2026-01-23T16:30:00+08:00",
        "days": []
      }
    }
  },
  "cascade_rules": {
    "wildcard_expansion": {
      "mode": "schema_driven",
      "note": "Wildcards expand against schema_contract.process_nodes, not regex",
      "examples": {
        "process_3_*": [
          "process_3_4_packages",
          "process_3_transportation"
        ],
        "process_*": [
          "process_2_destination",
          "process_3_4_packages",
          "process_3_transportation",
          "process_4_accommodation",
          "process_5_daily_itinerary"
        ]
      }
    },
    "triggers": [
      {
        "id": "cascade_active_dest_change",
        "trigger": "active_destination_change",
        "reset": [
          "process_5_daily_itinerary"
        ],
        "scope": "new_active_destination"
      },
      {
        "id": "cascade_date_change",
        "trigger": "process_1_date_anchor_change",
        "reset": [
          "process_3_*",
          "process_4_accommodation",
          "process_5_daily_itinerary"
        ],
        "scope": "all_destinations"
      },
      {
        "id": "cascade_dest_region_change",
        "trigger": "process_2_destination_change",
        "condition": {
          "field": "region",
          "changed": true
        },
        "reset": [
          "process_3_*",
          "process_4_accommodation",
          "process_5_daily_itinerary"
        ],
        "scope": "current_destination"
      },
      {
        "id": "cascade_package_select",
        "trigger": "process_3_4_packages_selected",
        "action": "populate",
        "populate_map": {
          "process_3_4_packages.results.chosen_offer.flight": "process_3_transportation.flight",
          "process_3_4_packages.results.chosen_offer.hotel": "process_4_accommodation.hotel"
        },
        "set_source": "package",
        "scope": "current_destination"
      }
    ]
  },
  "cascade_state": {
    "last_cascade_run": "2026-01-26T12:35:00+08:00",
    "global": {
      "process_1_date_anchor": {
        "dirty": true,
        "last_changed": "2026-01-27T09:50:37.324Z"
      },
      "active_destination_last": "tokyo_2026"
    },
    "destinations": {
      "tokyo_2026": {
        "process_2_destination": {
          "dirty": false,
          "last_changed": "2026-01-26T12:30:00+08:00"
        },
        "process_3_4_packages": {
          "dirty": false,
          "last_changed": "2026-01-28T15:46:41.859Z"
        },
        "process_3_transportation": {
          "dirty": false,
          "last_changed": "2026-01-28T15:46:41.859Z"
        },
        "process_4_accommodation": {
          "dirty": false,
          "last_changed": "2026-01-28T15:46:41.859Z"
        },
        "process_5_daily_itinerary": {
          "dirty": false,
          "last_changed": "2026-01-28T09:00:48.959Z"
        }
      },
      "nagoya_2026": {
        "process_2_destination": {
          "dirty": false,
          "last_changed": "2026-01-23T16:30:00+08:00"
        },
        "process_3_4_packages": {
          "dirty": true,
          "last_changed": null
        },
        "process_3_transportation": {
          "dirty": false,
          "last_changed": "2026-01-23T16:30:00+08:00"
        },
        "process_4_accommodation": {
          "dirty": true,
          "last_changed": null
        },
        "process_5_daily_itinerary": {
          "dirty": true,
          "last_changed": null
        }
      }
    }
  },
  "canonical_offer_schema": {
    "_comment": "All OTA scrapers MUST normalize to this shape",
    "required_fields": [
      "id",
      "source_id",
      "type",
      "currency",
      "price_per_person",
      "availability"
    ],
    "schema": {
      "id": {
        "type": "string",
        "format": "{source_id}_{product_code}"
      },
      "source_id": {
        "type": "string",
        "from": "ota_sources.{key}.source_id"
      },
      "product_code": {
        "type": "string"
      },
      "url": {
        "type": "string",
        "format": "uri"
      },
      "scraped_at": {
        "type": "string",
        "format": "ISO-8601"
      },
      "type": {
        "type": "string",
        "enum": [
          "package",
          "flight",
          "hotel",
          "activity"
        ]
      },
      "duration_days": {
        "type": "integer",
        "required_for": [
          "package"
        ]
      },
      "currency": {
        "type": "string",
        "default": "TWD"
      },
      "price_per_person": {
        "type": "number"
      },
      "price_total": {
        "type": "number",
        "computed": "price_per_person * pax"
      },
      "availability": {
        "type": "string",
        "enum": [
          "available",
          "sold_out",
          "limited",
          "unknown"
        ]
      },
      "seats_remaining": {
        "type": "integer",
        "nullable": true
      },
      "flight": {
        "type": "object",
        "required_for": [
          "package",
          "flight"
        ],
        "schema": {
          "airline": {
            "type": "string"
          },
          "airline_code": {
            "type": "string",
            "format": "IATA 2-letter"
          },
          "outbound": {
            "flight_number": {
              "type": "string"
            },
            "departure_airport_code": {
              "type": "string",
              "format": "IATA 3-letter"
            },
            "arrival_airport_code": {
              "type": "string",
              "format": "IATA 3-letter"
            },
            "departure_time": {
              "type": "string",
              "format": "HH:MM or ISO-8601"
            },
            "arrival_time": {
              "type": "string",
              "format": "HH:MM or ISO-8601"
            }
          },
          "return": {
            "same_as": "outbound",
            "nullable": true
          }
        }
      },
      "hotel": {
        "type": "object",
        "required_for": [
          "package",
          "hotel"
        ],
        "schema": {
          "name": {
            "type": "string"
          },
          "slug": {
            "type": "string"
          },
          "area": {
            "type": "string"
          },
          "star_rating": {
            "type": "number",
            "nullable": true
          },
          "access": {
            "type": "array",
            "items": "string"
          }
        }
      },
      "includes": {
        "type": "array",
        "items": {
          "type": "string",
          "enum": [
            "light_breakfast",
            "full_breakfast",
            "airport_transfer",
            "wifi",
            "luggage"
          ]
        }
      },
      "date_pricing": {
        "type": "object",
        "additionalProperties": {
          "price": {
            "type": "number"
          },
          "availability": {
            "type": "string"
          },
          "seats_remaining": {
            "type": "integer",
            "nullable": true
          }
        }
      },
      "best_value": {
        "date": {
          "type": "string",
          "format": "ISO-8601 date"
        },
        "price_per_person": {
          "type": "number"
        },
        "price_total": {
          "type": "number"
        }
      },
      "pros": {
        "type": "array",
        "items": "string"
      },
      "cons": {
        "type": "array",
        "items": "string"
      }
    }
  },
  "process_precedence": {
    "transport_hotel_resolution": {
      "primary": "process_3_4_packages",
      "fallback": [
        "process_3_transportation",
        "process_4_accommodation"
      ],
      "mode": "populate_on_select",
      "rules": [
        "If package selected → copy flight to process_3, hotel to process_4, mark source='package'",
        "If separate bookings selected → process_3_4_packages.status='skipped'",
        "Downstream (P5) reads from process_3 + process_4, not packages directly"
      ]
    }
  },
  "ota_sources": {
    "besttour": {
      "source_id": "besttour",
      "display_name": "喜鴻假期",
      "type": [
        "package"
      ],
      "base_url": "https://www.besttour.com.tw",
      "package_url_pattern": "/itinerary/{product_code}",
      "markets": [
        "TW"
      ],
      "currency": "TWD",
      "rate_limit": {
        "requests_per_minute": 10
      },
      "auth_required": false,
      "supported": true
    },
    "liontravel": {
      "source_id": "liontravel",
      "display_name": "雄獅旅遊",
      "type": [
        "package",
        "flight",
        "hotel"
      ],
      "base_url": "https://www.liontravel.com",
      "vacation_url": "https://vacation.liontravel.com",
      "event_url": "https://event.liontravel.com",
      "package_url_patterns": {
        "event_page": "/zh-tw/japan/tokyo/index",
        "fit_package": "/zh-tw/flightandhotel/package",
        "detail": "/detail/{product_id}",
        "freely": "/detail_freely/{product_id}"
      },
      "markets": [
        "TW"
      ],
      "currency": "TWD",
      "rate_limit": {
        "requests_per_minute": 10
      },
      "auth_required": false,
      "supported": true,
      "last_scraped": "2026-01-26T15:09:51+08:00",
      "promo_codes": [
        {
          "code": "FITPKG",
          "discount": 400,
          "min_order": 20000,
          "valid_days": [
            "thursday"
          ]
        }
      ]
    },
    "eztravel": {
      "source_id": "eztravel",
      "display_name": "易遊網",
      "type": [
        "package",
        "flight",
        "hotel"
      ],
      "base_url": "https://www.eztravel.com.tw",
      "markets": [
        "TW"
      ],
      "currency": "TWD",
      "rate_limit": {
        "requests_per_minute": 10
      },
      "auth_required": false,
      "supported": false
    },
    "tigerair": {
      "source_id": "tigerair",
      "display_name": "台灣虎航",
      "type": [
        "flight"
      ],
      "base_url": "https://www.tigerairtw.com",
      "booking_url": "https://booking.tigerairtw.com",
      "markets": [
        "TW"
      ],
      "currency": "TWD",
      "rate_limit": {
        "requests_per_minute": 5
      },
      "auth_required": false,
      "supported": true,
      "last_scraped": "2026-01-26T15:02:25+08:00",
      "notes": {
        "booking_url_format": "Direct booking requires interactive flow, cannot scrape specific dates easily",
        "promo_pricing_observed": {
          "kanto_from_tpe_march_2026": {
            "price": 4299,
            "currency": "TWD",
            "note": "One-way, untaxed"
          },
          "kix_from_tpe_feb_2026": {
            "price": 4299,
            "currency": "TWD",
            "note": "One-way, untaxed"
          },
          "ngo_from_khh_feb_2026": {
            "price": 4799,
            "currency": "TWD",
            "note": "One-way, untaxed"
          }
        },
        "feb_13_status": "Cannot retrieve specific date pricing - booking page requires interactive search"
      }
    }
  },
  "skill_io_contracts": {
    "common_input": {
      "active_destination": "string (slug from destinations.*)",
      "date_filters": {
        "start_date": "ISO-8601",
        "end_date": "ISO-8601",
        "flexible": "boolean",
        "preferred_dates": "[ISO-8601]",
        "avoid_dates": "[ISO-8601]"
      },
      "pax": "integer",
      "budget": {
        "total_cap": "number|null",
        "per_person_cap": "number|null"
      },
      "constraints": {
        "avoid_red_eye": "boolean",
        "prefer_direct": "boolean",
        "require_breakfast": "boolean"
      }
    },
    "common_output": {
      "offers": "[canonical_offer_schema objects]",
      "chosen_offer": "canonical_offer_schema | null",
      "provenance": "[{source_id, scraped_at, offers_found, errors}]",
      "warnings": "[string]"
    },
    "skills": {
      "p3p4_packages": {
        "input": "common_input + {sources: [source_id]}",
        "output": "common_output",
        "write_to": "destinations.{active_destination}.process_3_4_packages.results",
        "on_select": "trigger cascade_package_select"
      },
      "p3_flights": {
        "input": "common_input + {origin_airport, destination_airport}",
        "output": "common_output",
        "write_to": "destinations.{active_destination}.process_3_transportation.flight.candidates"
      },
      "p4_hotels": {
        "input": "common_input + {zone_slug, check_in, check_out}",
        "output": "common_output",
        "write_to": "destinations.{active_destination}.process_4_accommodation.hotel.candidates"
      },
      "compare_destinations": {
        "input": "{destination_slugs: [string]}",
        "output": "{comparison: derived, generated_from: destinations.*}",
        "write_to": null,
        "note": "Read-only, returns derived comparison"
      }
    }
  },
  "comparison": {
    "_derived": true,
    "_generated_at": "2026-01-26T17:40:00+08:00",
    "_generated_from": [
      "tokyo_2026",
      "nagoya_2026"
    ],
    "summary": {
      "tokyo_2026": {
        "display_name": "Tokyo",
        "status": "active",
        "best_price_2pax": 36776,
        "best_date": "2026-02-22",
        "type": "package",
        "source": "besttour",
        "offer_id": "besttour_TYO05MM260211AM",
        "availability": "available",
        "seats_remaining": 2,
        "includes": [
          "flight",
          "hotel",
          "light_breakfast"
        ],
        "note": "Date-specific pricing confirmed. Feb 11-13 sold out."
      },
      "nagoya_2026": {
        "display_name": "Nagoya",
        "status": "archived",
        "best_price_2pax": 13400,
        "best_date": "2026-02-11",
        "type": "flight_only",
        "source": "direct_research",
        "availability": "estimated",
        "includes": [
          "flight"
        ],
        "missing": [
          "hotel"
        ]
      }
    },
    "price_ranking": [
      {
        "destination": "nagoya_2026",
        "price_2pax": 13400,
        "type": "flight_only",
        "note": "Needs hotel added - archived"
      },
      {
        "destination": "tokyo_2026",
        "price_2pax": 36776,
        "source": "besttour",
        "date": "2026-02-22",
        "type": "package",
        "note": "Best price if flexible"
      },
      {
        "destination": "tokyo_2026",
        "price_2pax": 39776,
        "source": "besttour",
        "date": "2026-02-21",
        "type": "package",
        "note": "2nd cheapest"
      },
      {
        "destination": "tokyo_2026",
        "price_2pax": 55776,
        "source": "besttour",
        "date": "2026-02-13",
        "type": "package",
        "note": "★ AGENT OFFERED - closest to original dates"
      },
      {
        "destination": "tokyo_2026",
        "price_2pax": 69776,
        "source": "besttour",
        "date": "2026-02-14",
        "type": "package",
        "note": "CNY peak - expensive"
      }
    ],
    "recommendation": {
      "best_option": {
        "date": "2026-02-13",
        "package": "besttour_TYO05MM260211AM",
        "price_2pax": 55776,
        "reason": "Agent offered Feb 13 as alternative to sold-out Feb 11. Depart Fri Feb 13, return Tue Feb 17."
      },
      "budget_option": {
        "date": "2026-02-22",
        "package": "besttour_TYO05MM260211AM",
        "price_2pax": 36776,
        "reason": "Best price if dates are flexible. Depart Sun Feb 22, return Thu Feb 26."
      },
      "original_dates_status": {
        "date": "2026-02-11",
        "status": "SOLD_OUT",
        "alternative": "Agent offered Feb 13 instead"
      }
    }
  },
  "schema_contract": {
    "id_convention": "snake_case_with_year",
    "slug_is_authoritative": true,
    "display_names_in": "destinations.{slug}.display_name",
    "timestamps": "ISO-8601 with timezone",
    "currency": "TWD",
    "process_nodes": [
      "process_2_destination",
      "process_3_4_packages",
      "process_3_transportation",
      "process_4_accommodation",
      "process_5_daily_itinerary"
    ]
  }
}